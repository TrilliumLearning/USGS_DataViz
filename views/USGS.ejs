<!DOCTYPE html>
<html lang="en">
<head>
    <!--NOTE: Most Web WorldWind bak use jquery, Bootstrap and requirejs but those technologies are NOT-->
    <!--required by Web WorldWind. See SimplestExample.html for an example of using Web WorldWind without them.-->
    <meta charset="utf-8"/>
    <title>CitySmart - WorldWise v2</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
    <link href="http://www.jqueryscript.net/css/jquerysctipttop.css" rel="stylesheet" type="text/css">
    <link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="../css/menu.css"/>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" type="text/javascript"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
    <script data-main="../scripts/Main" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.1.17/require.min.js"></script>

</head>
<body>
<div class="container">
    <div>
        <img src="../images/TL_WB_Banner.jpg" align="middle" alt="Placeholder Image" />
    </div>
<div>
    <br>
    <a href="/login" class="btn btn-warning btn-lg" style="font-size:16px;margin-top:20px;">Submit Layer Request</a>

    <div class="row">
        <div class="col-sm-3">
            <div class="container">
                <br>
                <h4>Please Select Here First</h4>
                <div>
                    <p>
                        <select id="myListCountry"  style="width:180px; height:21px; background:white" onchange="ChangeSelectList(this.value)">
                            <option selected="selected" value="AL">All Layer</option>
                            <!--<option>United States of America</option>-->
                            <!--<option value="AL" selected="selected" class="a">All Layer</option>-->
                        </select>
                    </p>
                </div>
                <div>
                    <p>
                        <select id="myListState"  style="width:180px; height:21px; background:lightgray" onchange="ChangeStateList(this.value)">
                            <option selected="selected" value="AL">All Layer</option>
                            <!--<option>-Select a State-</option>-->
                        </select>
                    </p>
                </div>
                <div>
                    <p>
                        <select id="myListCity"  style="width:180px; height:21px; background:lightgray" onchange="ChangeLayerList(this.value)">
                            <option selected="selected" value="AL">All Layer</option>
                        </select>
                    </p>
                </div>
            </div>
            <br>
            <div class="container">
                <h4>Menu</h4>

                <div class="panel-group medium-3" id="accordion">

                </div>
            </div><!-- /.panel-group -->
        </div>
        <div class="col-sm-9" id="globe">
            <canvas id="canvasOne" width="1000" height="1000" style="width: 100%; height: auto;">
                Your browser does not support HTML5 Canvas.
            </canvas>
        </div>

    </div>

</div>
</div>
</body>
<script>


    $(document).ready(function() {

        var parentmenu = document.getElementById("accordion");

        function unpack(rows, key) {
            return rows.map(function(row) { return row[key]; })
        }

        $.ajax({
            type: "GET",
            url: "http://localhost:9085/createlayer",
            dataType: "json",
            success: function (res) {
                var firstlayer = [];
                var secondlayer = [];
                var thirdlayer = [];
                var layervalue =[];
                var comparing = [];
                var comparing3 = [];
                var classname = [];
                var removefirstlayer = unpack(res, 'FirstLayer');
                var removesecondlayer = unpack(res, 'SecondLayer');
                var removethirdlayer = unpack(res,"ThirdLayer");
                var Layerinfo = unpack(res,"LayerName");
                // console.log(removethirdlayer);

                $.each(removefirstlayer, function (index, value) {
                    if($.inArray(value, firstlayer) === -1) firstlayer.push(value);
                });
                $.each(removesecondlayer, function (index, value) {
                    if($.inArray(value, secondlayer) === -1) secondlayer.push(value);
                });
                $.each(removethirdlayer, function (index, value) {
                    if($.inArray(value, thirdlayer) === -1) thirdlayer.push(value);
                    // console.log(thirdlayer);
                });
                $.each(Layerinfo, function (index, value) {
                    layervalue.push(value);
                });

                // console.log(res);
                // console.log(firstlayer);
                // console.log(secondlayer);
                // console.log(thirdlayer);
                // console.log(layervalue);
                // console.log(Layerinfo);
                if(comparing.length === 0){
                    comparing.push(["firstlayer","secondlayer"]);
                }
                if(comparing3.length === 0){
                    comparing3.push(["thirdlayer","layermenu"]);
                }
                if(classname.length === 0){
                    classname.push("classname");
                }
                var createfirstlayer = function() {


                    $.each(firstlayer, function (i) {

                        var paneldefault1 = document.createElement("div");
                        paneldefault1.className = "Menu panel panel-default " + firstlayer[i] ;
                        var panelheading1 = document.createElement("div");
                        panelheading1.className = "panel-heading";
                        var paneltitle1 = document.createElement("h4");
                        paneltitle1.className = "panel-title";
                        var collapsed1 = document.createElement("a");
                        collapsed1.className = "collapsed";
                        collapsed1.setAttribute("data-toggle", "collapse");
                        collapsed1.setAttribute("data-parent", "#accordion");
                        collapsed1.href = "#collapse" + i;
                        var firstlayername = document.createTextNode(firstlayer[i]);
                        firstlayername.className = "menuwords";
                        var collapseone = document.createElement("div");
                        collapseone.className = "panel-collapse collapse";
                        collapseone.id = "collapse" + i;
                        var panelbody1 = document.createElement("div");
                        panelbody1.className = "panel-body";
                        var panelgroup1 = document.createElement("div");
                        panelgroup1.className = "panel-group " + firstlayer[i];
                        panelgroup1.id = "nested" + i;

                        collapsed1.appendChild(firstlayername);
                        paneltitle1.appendChild(collapsed1);
                        collapseone.appendChild(panelbody1);
                        panelbody1.appendChild(panelgroup1);
                        panelheading1.appendChild(paneltitle1);
                        paneldefault1.appendChild(panelheading1);
                        parentmenu.appendChild(paneldefault1);
                        paneldefault1.appendChild(collapseone);
                        // console.log(paneldefault1);
                        // firstlayer ending
                    });

                };
                var createotherlayer = function() {
                    $.each(res, function (i) {
                        for (var v = 0; v < comparing.length; v++) {
                            //secondlayer beginning
                            if (comparing[v][1] !== res[i].SecondLayer) {
                                // console.log("v" + v);

                                if(v === comparing.length - 1) {
                                    var paneldefault2 = document.createElement("div");
                                    paneldefault2.id = res[i].SecondLayer;
                                    paneldefault2.className = "Menu panel panel-default "+ res[i].SecondLayer;
                                    var panelheading2 = document.createElement("div");
                                    panelheading2.className = "panel-heading";
                                    var paneltitle2 = document.createElement("h4");
                                    paneltitle2.className = "panel-title";
                                    var collapsed2 = document.createElement("a");
                                    collapsed2.className = "collapsed";
                                    collapsed2.setAttribute("data-toggle", "collapse");
                                    collapsed2.setAttribute("data-parent", "#nested");
                                    collapsed2.href = "#" + res[i].FirstLayer + "-" + res[i].SecondLayer;
                                    var secondlayername = document.createTextNode(res[i].SecondLayer);
                                    secondlayername.className = "menuwords";
                                    var nested1c1 = document.createElement("div");
                                    nested1c1.id = res[i].FirstLayer + "-" + res[i].SecondLayer;
                                    nested1c1.className = "panel-collapse collapse";
                                    var panelbody3 = document.createElement("div");
                                    panelbody3.className = "panel-body " + res[i].SecondLayer;

                                    paneldefault2.appendChild(panelheading2);
                                    panelheading2.appendChild(paneltitle2);
                                    paneldefault2.appendChild(nested1c1);
                                    nested1c1.appendChild(panelbody3);
                                    collapsed2.appendChild(secondlayername);
                                    paneltitle2.appendChild(collapsed2);

                                    document.getElementsByClassName("panel-group " + res[i].FirstLayer)[0].appendChild(paneldefault2);
                                    comparing.push([res[i].FirstLayer, res[i].SecondLayer]);
                                    // console.log(comparing);
                                }
                            } else {
                                break;
                            }

                        }// secondlayer ending

                        if (res[i].LayerType === "Wmslayer") {

                            for (var c = 0; c < comparing3.length; c++) {

                                if (comparing3[c][0] !== res[i].ThirdLayer) {

                                    if (c === comparing3.length - 1) {
                                        var checkboxdivG = document.createElement("div");
                                        checkboxdivG.className = "State " + res[i].ThirdLayer + " " + res[i].StateName + " " + res[i].CityName;
                                        // console.log(checkboxdivG.className);
                                        var checkboxh5G = document.createElement("h5");
                                        var checkboxaG = document.createElement("a");
                                        var checkaboxatG = document.createTextNode(res[i].ThirdLayer);
                                        checkaboxatG.className = "menuwords";
                                        var checkboxlabelG = document.createElement("label");
                                        checkboxlabelG.className = "switch right";
                                        var checkboxinputG = document.createElement("input");
                                        checkboxinputG.type = "checkbox";
                                        checkboxinputG.className = "input" + res[i].ThirdLayer;
                                        checkboxinputG.id = res[i].LayerType;
                                        checkboxinputG.setAttribute("value", res[i].LayerName);
                                        var checkboxspanG = document.createElement("span");
                                        checkboxspanG.className = "slider round";
                                        checkboxdivG.appendChild(checkboxh5G);
                                        checkboxaG.appendChild(checkaboxatG);
                                        checkboxh5G.appendChild(checkboxaG);
                                        checkboxh5G.appendChild(checkboxlabelG);
                                        checkboxlabelG.appendChild(checkboxinputG);
                                        checkboxlabelG.appendChild(checkboxspanG);
                                        document.getElementsByClassName("panel-body " + res[i].SecondLayer)[0].appendChild(checkboxdivG);
                                        comparing3.push([res[i].ThirdLayer, res[i].LayerName]);
                                        classname.push([res[i].ThirdLayer +" " + res[i].CityName + res[i].StateName, res[i].CityName]);
                                    }

                                } else {

                                    if (comparing3[c][1] !== res[i].LayerName) {
                                        document.getElementsByClassName("input" + res[i].ThirdLayer)[0].removeAttribute("value");
                                        comparing3[c][1] += "," + res[i].LayerName;
                                        document.getElementsByClassName("input" + res[i].ThirdLayer)[0].setAttribute("value", comparing3[c][1]);
                                        // console.log(document.getElementsByClassName(res[i].ThirdLayer)[0]);

                                    }
                                    if (classname[c][0] !== res[i].ThirdLayer +" "+ res[i].CityName  + " " + res[i].StateName) {
                                        classname[c][0] += " " + res[i].CityName + res[i].StateName;
                                        // classname[c][1] += res[i].CityName;
                                        document.getElementsByClassName("State " + res[i].ThirdLayer)[0].className = "State " + classname[c][0];

                                        if (classname[c][1] !== res[i].CityName) {

                                            document.getElementsByClassName(classname[c][0])[0].className += " " + res[i].CityName;
                                        }

                                    }

                                }
                            }
                        }

                        if (res[i].LayerType === "Placemark") {

                            for (var a = 0; a < comparing3.length; a++) {

                                if (comparing3[a][0] !== res[i].ThirdLayer) {

                                    if (a === comparing3.length - 1) {
                                        var checkboxdiv = document.createElement("div");
                                        checkboxdiv.className = "State " + res[i].ThirdLayer + " " + res[i].StateName + " " + res[i].CityName;
                                        var checkboxh5 = document.createElement("h5");
                                        var checkboxa = document.createElement("a");
                                        var checkaboxat = document.createTextNode(res[i].ThirdLayer);
                                        var checkboxlabel = document.createElement("label");
                                        checkboxlabel.className = "switch right";
                                        var checkboxinput = document.createElement("input");
                                        checkboxinput.type = "checkbox";
                                        checkboxinput.id = res[i].LayerType;
                                        checkboxinput.className = "input" + res[i].ThirdLayer;
                                        checkboxinput.setAttribute("value", res[i].LayerName);
                                        var checkboxspan = document.createElement("span");
                                        checkboxspan.className = "slider round";
                                        checkboxdiv.appendChild(checkboxh5);
                                        checkboxa.appendChild(checkaboxat);
                                        checkboxh5.appendChild(checkboxa);
                                        checkboxh5.appendChild(checkboxlabel);
                                        checkboxlabel.appendChild(checkboxinput);
                                        checkboxlabel.appendChild(checkboxspan);
                                        document.getElementsByClassName("panel-body " + res[i].SecondLayer)[0].appendChild(checkboxdiv);
                                        comparing3.push([res[i].ThirdLayer, res[i].LayerName]);
                                        classname.push([res[i].ThirdLayer +" "+ res[i].CityName + res[i].StateName,  res[i].CityName]);

                                    }
                                }
                                else {
                                    document.getElementsByClassName("input" + res[i].ThirdLayer)[0].setAttribute("value", res[i].LayerName);
                                    if (classname[a][0] !== res[i].ThirdLayer +" "+ res[i].CityName + " " + res[i].StateName) {
                                        classname[a][0] += " " + res[i].CityName + res[i].StateName;
                                        document.getElementsByClassName("State " + res[i].ThirdLayer)[0].className ="State "+ classname[a][0];

                                        if (classname[a][1] !== res[i].CityName) {
                                            document.getElementsByClassName(classname[a][0])[0].className += " " + res[i].CityName;

                                        }

                                    }

                                }

                            }
                        }

                    });

                };

                createotherlayer(createfirstlayer());
                // console.log(classname);
                // console.log(parentmenu);
                // console.log(document.getElementsByClassName("State "));
            },
            error: function (jqXHR, exception) {
                var msg = '';
                if (jqXHR.status === 0) {
                    msg = 'Not connect.\n Verify Network.';
                } else if (jqXHR.status == 404) {
                    msg = 'Requested page not found. [404]';
                } else if (jqXHR.status == 500) {
                    msg = 'Internal Server Error [500].';
                } else if (exception === 'parsererror') {
                    msg = 'Requested JSON parse failed.';
                } else if (exception === 'timeout') {
                    msg = 'Time out error.';
                } else if (exception === 'abort') {
                    msg = 'Ajax request aborted.';
                } else {
                    msg = 'Uncaught Error.\n' + jqXHR.responseText;
                }
                console.log(msg);

            }

        });
    });
</script>
</html>